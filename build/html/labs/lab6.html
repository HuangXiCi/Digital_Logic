

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>移位乘法器设计 &mdash; 深圳理工大学-数字逻辑基础与Verilog设计-实验课程 0.1 文档</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=e50e972b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=7c91f8fd"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/translations.js?v=beaddf03"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="番外一 EDA发展史" href="../extra/extra1.html" />
    <link rel="prev" title="时序逻辑电路设计" href="lab5.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            深圳理工大学-数字逻辑基础与Verilog设计-实验课程
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">实验课程目录</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lab1.html">实验一 异或门</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">实验二 加法器设计与仿真</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">实验三 加减法器设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">实验四 桶形移位器设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab5.html">实验五 时序逻辑电路设计</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">实验六 移位乘法器设计</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">二进制乘法的原理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">阵列乘法器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">多周期移位乘法器实现</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id5">有符号数乘法的问题</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">二进制数的补码表示</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">计算有符号数乘法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">方法1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">方法2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id10">设计多周期移位乘法器</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id11">求2的补码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">输入为 0 的特殊情况</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id13">状态机设计</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../extra/extra1.html">番外一 EDA发展史</a></li>
<li class="toctree-l1"><a class="reference internal" href="TODO.html">敬请期待</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">深圳理工大学-数字逻辑基础与Verilog设计-实验课程</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">移位乘法器设计</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/labs/lab6.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>移位乘法器设计<a class="headerlink" href="#id1" title="Link to this heading"></a></h1>
<p>本次实验需要理解移位加法乘法器的工作原理，并掌握有符号乘法通过无符号运算实现的方法。</p>
<section id="id2">
<h2>二进制乘法的原理<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>设被乘数为 A，乘数为 B，且 A、B 都为 16 位无符号数：</p>
<div class="math notranslate nohighlight">
\[B = \sum_{i=0}^{15} b_i \cdot 2^i\]</div>
<p>则乘法可以表示为：</p>
<div class="math notranslate nohighlight">
\[A \times B = \sum_{i=0}^{15} (b_i \cdot A \cdot 2^i)\]</div>
<p>其中，当 <code class="docutils literal notranslate"><span class="pre">b_i</span></code> 为 1 时，对应的部分积为 <code class="docutils literal notranslate"><span class="pre">A</span></code> 左移 <code class="docutils literal notranslate"><span class="pre">i</span></code> 位；
当 <code class="docutils literal notranslate"><span class="pre">b_i</span></code> 为 0 时，对应部分积为 0。</p>
<section id="id3">
<h3>阵列乘法器<a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<figure class="align-center">
<img alt="阵列乘法器" src="../_images/%E9%98%B5%E5%88%97%E4%B9%98%E6%B3%95%E5%99%A8.png" />
</figure>
<p>在学习算数运算电路的时候，课堂上介绍了阵列乘法器，通过硬连线的方式实现移位操作，
使用全加器或者其他的加法器将部分积依次相加，得到最后的乘法结果。结构如上图所示。
实现了两个无符号的二进制数相乘。也介绍了阵列乘法器有符号数与无符号数，有符号数与有符号数的乘法实现。</p>
</section>
<section id="id4">
<h3>多周期移位乘法器实现<a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>对于两个n位宽的二进制数乘法电路，当n的值比较大时，使用阵列乘法器实现需要大量的门电路，
并且关键路径会非常长，单周期内难以完成乘法计算。</p>
<p>另一种方案是通过一个移位寄存器和一个加法器，通过若干个周期完成乘法计算。
对于16位的乘法器，每个周期完成以下操作：</p>
<ol class="arabic simple">
<li><p>判断乘数最低位</p></li>
<li><p>若该位为 1，则将被乘数加到部分积寄存器</p></li>
<li><p>被乘数左移一位</p></li>
<li><p>乘数右移一位</p></li>
<li><p>计数器加 1</p></li>
</ol>
<p>当计数器达到 15 时，运算结束，得到乘法最终的结果。
对于移位乘法器，硬件实现结构简单，运算时间与位宽成正比。</p>
<figure class="align-center">
<img alt="移位乘法器" src="../_images/%E7%A7%BB%E4%BD%8D%E4%B9%98%E6%B3%95%E5%99%A8.png" />
</figure>
</section>
</section>
<section id="id5">
<h2>有符号数乘法的问题<a class="headerlink" href="#id5" title="Link to this heading"></a></h2>
<p>如果乘数是补码表示的正数，可以使用和无符号数一致的方法运算。
被乘数可以是补码表示的正数或者负数，当为负数时需要对符号位进行扩展。
而乘数是补码表示的负数时，则需要做额外的处理。</p>
<section id="id6">
<h3>二进制数的补码表示<a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>补码我们已经很熟悉了。</p>
<figure class="align-center">
<img alt="补码表示" src="../_images/%E8%A1%A5%E7%A0%81%E8%A1%A8%E7%A4%BA.png" />
</figure>
<p>对于 N 位二进制补码数，其数值可以表示为：</p>
<div class="math notranslate nohighlight">
\[B = -b_{N-1} \cdot 2^{N-1} + \sum_{i=0}^{N-2} b_i \cdot 2^i\]</div>
<div class="admonition myhint">
    <p class="admonition-title"> 2的补码表示法 </p>
    <p>证明上面的 N 位二进制补码数的数值表示公式。若给出一个补码表示的负数，让我们计算表示的值，有两种常见的办法。
    第一种对它求2的补码，也就是对它进行取反加一，得到它的绝对值，再加上负号。例如求补码 11111110 表示的值，
    取反得到 00000001 ，再加一得到 00000010，也就是2，因此补码 11111110 表示-2。或者直接使用公式计算数值表示，
    例如求补码 11000000 表示的值，也就是-128 + 64 = -64。可以根据1的个数，选取合适的方法快速计算出补码表示的负数的值。</p>
</div><p>其中最高位 <code class="docutils literal notranslate"><span class="pre">b_{N-1}</span></code> 为符号位，具有负权重。
这意味着补码中的最高位并不能像普通的位一样
通过“移位加法”直接参与部分积计算。</p>
</section>
<section id="id7">
<h3>计算有符号数乘法<a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<section id="id8">
<h4>方法1<a class="headerlink" href="#id8" title="Link to this heading"></a></h4>
<p>有符号数通常使用补码来表示。对于补码表示的负数，我们可以求2的补码，统一转换为正数进行计算。如果乘数和被乘数都是补码表示的负数，
那么结果不需要再进行改变，如果只有乘数或者被乘数是补码表示的负数，则对计算结果也求2的补码，得到最终的结果。</p>
<p>为正确实现有符号乘法，可以采用如下步骤：</p>
<ol class="arabic simple">
<li><p>判断输入 A 和 B 的符号位</p></li>
<li><p>若为负数，取其补码，转换为无符号数</p></li>
<li><p>使用无符号移位乘法器计算乘积</p></li>
<li><p>根据 A 和 B 的原始符号，对结果进行符号修正</p></li>
</ol>
<p>最终结果的符号由以下关系确定：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result_sign</span> <span class="o">=</span> <span class="n">A_sign</span> <span class="o">^</span> <span class="n">B_sign</span>
</pre></div>
</div>
<p>若 <code class="docutils literal notranslate"><span class="pre">result_sign</span></code> 为 1，则对无符号乘积求2的补码。</p>
</section>
<section id="id9">
<h4>方法2<a class="headerlink" href="#id9" title="Link to this heading"></a></h4>
<p>当然也可以通过另一种办法计算有符号数乘法，被乘数乘以乘数的某一位得到部分积，最后每个部分积之间做加法，补码是可以直接进行加法的。
如果被乘数是补码表示的负数，部分积则需要扩展符号位。一种更好的方式是，相较于上面的“移位加乘法器”的结构，乘数和被乘数的移位方向都反过来。
被乘数A使用算数右移，而乘数B使用左移，先对高位相乘，依次往下计算部分积并相加。
被乘数A则不是放入移位寄存器的最低位，而是放在高位，并在最高位补上符号位，这样算数右移即可实现符号位的扩展。</p>
<figure class="align-center">
<img alt="被乘数算数右移" src="../_images/%E8%A2%AB%E4%B9%98%E6%95%B0%E7%AE%97%E6%95%B0%E5%8F%B3%E7%A7%BB.png" />
</figure>
<p>对于乘数B，如果是补码表示的负数，可以求2的补码，转换为正数进行计算，然后对计算结果也求2的补码，得到最终的结果。
当然也可以根据公式，最高位具有负权重，需要对部分积求2的补码，其余位则保持一致即可。当然也可以最后对结果进行修正，
本来应该乘以 -2^n-1 ，但正常处理就乘以了 2^n-1 ，因此最后减去 A * (2^n) ，就能得到正确的结果。</p>
</section>
</section>
</section>
<section id="id10">
<h2>设计多周期移位乘法器<a class="headerlink" href="#id10" title="Link to this heading"></a></h2>
<p>多周期移位乘法器本身就是适用于两个无符号数计算相乘，通过额外的电路结构，即可计算有符号数乘法，在上面已经讲了一些实现的方法，
需要你去仔细的思考、比较，并选择出一种合理的方案：既可以计算两个无符号数相乘，也可以计算两个补码表示的有符号数相乘，
还能计算一个无符号数和一个补码表示的有符号数相乘。</p>
<div class="admonition mytodo">
     <p class="admonition-title"> 设计你的多周期移位乘法器 </p>
     <p>我们的乘法器需要能够完成上述功能，既可以计算两个无符号数相乘，也可以计算两个补码表示的有符号数相乘，
     还能计算一个无符号数和一个补码表示的有符号数相乘。我们通过两个输入信号表明乘数和被乘数分别是无符号数，
     还是补码表示的有符号数。写出你认为合适的方案，并参照上面给出的移位乘法器的电路结构，画出你的电路结构。</p>
</div><section id="id11">
<h3>求2的补码<a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<p>求2的补码有多种方式，最常见的方式就是取反加一（其1的补码加1），或者减一再取反，这两种方式都可以用一个加法器和反相器简单实现。
也可以不使用加法器实现，我们保留从右往左的第一个&quot;1&quot;及其右边的&quot;0&quot;不变，其余位全部取反。
比如对 11100000 求2的补码，保留从右往左的第一个&quot;1&quot;及其右边的&quot;0&quot;，也就是低6位保持不变，高2位取反，
得到 00100000，随便尝试一些数求2的补码，检查是否与取反加一的结果一致。</p>
<div class="admonition myoption">
     <p class="admonition-title"> 求2的补码 </p>
     <p>保留从右往左的第一个"1"及其右边的"0"不变，其余位全部取反，为什么就能求2的补码，尝试给出证明。
     如何实现该电路呢？我们可以从低位一直或到最高位，检查最低位是不是1，如果不是，最低为或上次低位，如果为1，则次低位为1，如果不是，将或的结果与更高一位相或...
     这样就能得知第一个"1"的位置，并且第一个"1"之后的或会一直传播下去，然后利用异或门可控取反。</p>
</div></section>
<section id="id12">
<h3>输入为 0 的特殊情况<a class="headerlink" href="#id12" title="Link to this heading"></a></h3>
<p>若 A 或 B 任意一个为 0，则乘法结果必然为 0。
在这种情况下，状态机可以直接跳转到完成状态，
无需进入移位计算过程，从而简化计算。</p>
</section>
<section id="id13">
<h3>状态机设计<a class="headerlink" href="#id13" title="Link to this heading"></a></h3>
<p>我们可以通过有限状态机控制乘法过程，参考的状态划分如下：</p>
<ul class="simple">
<li><p>IDLE：等待开始信号</p></li>
<li><p>PREPARE：符号判断与无符号转换、输入是否为 0</p></li>
<li><p>CALC：移位加法计算</p></li>
<li><p>SIGN_FIX：结果修正</p></li>
<li><p>DONE：计算完成，输出结果，标明计算结果已经完成</p></li>
</ul>
<p>你可以根据设计情况自由修改状态机。</p>
<div class="admonition mytodo">
     <p class="admonition-title"> FSM 状态转移图 </p>
     <p>完成好乘法器设计之后，画出你的完整的状态转移图。</p>
</div><div class="admonition mytodo">
     <p class="admonition-title"> 实现你的多周期移位乘法器 </p>
     <p>实现多周期移位乘法器的RTL编写，我们本次不给出框架代码，请自行思考。
     实现后，编写 testbench 程序，验证你的多周期移位乘法器，需要对计算两个无符号数相乘，计算两个补码表示的有符号数相乘，
     计算一个无符号数和一个补码表示的有符号数相乘进行测试。目前不需要上FPGA板，等之后完成了输入输出的部分再进行上板实验。</p>
</div></section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="lab5.html" class="btn btn-neutral float-left" title="时序逻辑电路设计" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../extra/extra1.html" class="btn btn-neutral float-right" title="番外一 EDA发展史" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2025, 深圳理工大学。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>